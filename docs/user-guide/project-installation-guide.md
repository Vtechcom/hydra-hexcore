# Project Installation & Configuration Guide (Linux)

## 1. Most Important Requirement

- **You must have a working Cardano node** (mainnet, preprod, preview, etc.) running and fully synced. The node must produce a valid `node.socket` file.
- **Docker & Docker Compose** installed.
- **Node.js** version >= 20.x.
- **pnpm** (or npm/yarn) for package management.

## 2. Environment Configuration

### 2.1. Create the .env file

- Copy `.env.example` to `.env`:
  ```sh
  cp .env.example .env
  ```

### 2.2. Edit `.env` (explanation for each key variable)

- `NEST_HYDRA_NODE_FOLDER`: Directory to store keys generated by hydra-node. You can set this to any writable directory, e.g. `/home/youruser/hydra-data` (should be a dedicated directory with write permission).
- `NEST_HYDRA_NODE_SCRIPT_TX_ID`: Get the correct value for your environment from the hydra-node release page:  
  https://github.com/cardano-scaling/hydra-node/pkgs/container/hydra-node  
  or Cardano/Hydra official documentation.  
  (Each environment has a different script tx id, do NOT use a random value).
- `NEST_HYDRA_NODE_NETWORK_ID`:  
  - 1: mainnet  
  - 0: preprod  
  - 2: preview  
  - ... (depending on your node environment)
- `NEST_CARDANO_NODE_SERVICE_NAME`: Service name if you use docker-compose for cardano-node (e.g. `cardano-node`). If running node externally, you can ignore this.
- `NEST_CARDANO_NODE_FOLDER`: Directory containing your `node.socket` (e.g. `/home/youruser/cardano-node`).
- `NEST_CARDANO_NODE_SOCKET_PATH`: Absolute path to your `node.socket` (e.g. `/home/youruser/cardano-node/node.socket`).
- Other variables (DB, Redis, log, etc.) can be left as default if using the provided docker-compose files.

## 3. Directory & File Permissions

### 3.1. Granting Permissions

The user running hydra-hexcore must have read/write access to:
- The directory and file for `node.socket` (and all parent directories).
- The hydra data directory (`NEST_HYDRA_NODE_FOLDER`).
- Any log or data directories used by the app.

Example (replace with your actual paths):
```sh
sudo chown -R $USER:$USER /home/youruser/cardano-node
sudo chmod -R 777 /home/youruser/cardano-node
sudo chown -R $USER:$USER /home/youruser/hydra-data
sudo chmod -R 777 /home/youruser/hydra-data
```

If running in Docker, make sure the container user has access to the mounted host directories/files.

### 3.2. Common Permission Errors & Solutions

- **Error: `node.socket` not found or permission denied**
  - Cause: The hydra-hexcore process cannot read the `node.socket` file.
  - Solution: Ensure the path is correct and the user has read access. Use `ls -l` to check permissions. Fix with `sudo chown` and `sudo chmod` as above.
- **Error: Cannot write to hydra data directory**
  - Cause: The hydra-hexcore process cannot write to the directory specified in `NEST_HYDRA_NODE_FOLDER`.
  - Solution: Grant write permissions as above.
- **Error: Docker container cannot access host files**
  - Cause: Volume mount permissions are too restrictive.
  - Solution: Use `chmod`/`chown` on the host, or run the container as the correct user.

## 4. Docker Compose Configuration

### 4.1. Ogmios (if you want to use the provided Ogmios docker-compose)

- Edit `configs/ogmios/docker-compose.yml`, update the `volumes` section:
  ```yaml
  volumes:
    - /path/to/your/cardano-node:/cardano-node
  ```
  (Replace `/path/to/your/cardano-node` with the actual directory containing `node.socket` and `config.json`.)
- Ensure the `command` section in docker-compose points to the correct file paths:
  ```yaml
  command:
    [
      "--node-socket", "/cardano-node/node.socket",
      "--node-config", "/cardano-node/config.json",
      "--host", "0.0.0.0"
    ]
  ```
- From the `configs/ogmios` directory, run:
  ```sh
  docker compose up -d
  ```

### 4.2. MySQL & Redis

- Edit `configs/mysql-databases-redis/docker-compose.yaml` if you want to change the data storage location.
- From the `configs/mysql-databases-redis` directory, run:
  ```sh
  docker compose up -d
  ```

## 5. Build & Start hydra-hexcore

```sh
pnpm install
pnpm run build
pnpm start
```

## 6. Notes & Checking

- Make sure all ports are available and not in use by other services.
- Ensure the user running hydra-hexcore has the correct permissions for all required files and directories.
- API docs available at:  
  http://localhost:3010/api-docs (or the PORT you set in .env)
- If you encounter connection errors to node, ogmios, redis, or mysql: double-check the path, host, port, and permissions.

---

If you need more detailed instructions for any step, please ask!

---

**Summary for using external cardano-node/ogmios:**
- If you use an external cardano-node or ogmios, just set the correct path, host, and port in your `.env` file.
- You do NOT need to run the cardano-node/ogmios docker-compose services from this project.
- Make sure the user running hydra-hexcore has permission to access the `node.socket` file.

**Additional notes:**
- Make sure all service ports do not conflict with other applications on your machine.
- If you encounter file or directory permission errors, check and fix permissions as described above.
- For more details, see `README.md`, the `docs/` folder, or contact the project admin for support.
